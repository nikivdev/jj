# Upstream Sync — 2026-02-24

Synced 51 commits from `upstream/main` (jj-vcs/jj).

## Highlights

### Async Runtime Migration
Major push converting core operations to async:
- `MergedTreeBuilder::write_tree()` now async
- `MutableRepo`, `ReadonlyRepo`, `RepoLoader` functions converted to async
- `op_heads_store::resolve_op_heads` accepts async resolver
- `Operation::view`, `IndexStore::get_index_at_op`, `MutableIndex::add_commit` now async
- `transaction`, `workspace` modules converted to async

### Gerrit Integration
- `jj gerrit upload` options implemented
- Support for alternative `Link` change-id trailer
- Default revisions for `jj gerrit upload`

### CLI Improvements
- Progress indicator for `debug index-changed-paths`
- Inner progress writer made public with renamed type
- Git push signing progress callback inlined
- Hint for misconfigured default command with whitespace

### Bookmarks
- New `jj tug` inspired advance command (`jj bookmarks advance`)

### Revset / Templater
- Neighbor expressions accepted at pattern value position
- Unary negation operator parsing extracted
- Literal and negation accepted at pattern value position
- Builtin alias redefinition check moved to separate loop
- Config helper for loading revset/template aliases

### Templates
- `builtin_draft_commit_description_with_diff` added
- `new_description` template evaluated for new commits

### Conflicts / Split
- After parsing conflict markers, contents written to backend concurrently
- `split` warns instead of failing on empty commit with path argument

### Bug Fixes
- `new --after` preserves order of new children's parents
- `debug object` allows lookup by revision for files and symlinks
- Workspace-dependent immutable commits test added
- Regression test for bad Git URL decoding

### Dependencies
- `gix` bumped to 0.80.0
- cargo-dependencies group updated (6 packages)
- `cargo-insta` updated to 1.63.3 (with fix)
- `devalue` bumped 5.6.2 → 5.6.3 (web docs)
- GitHub dependencies group updated (2 packages)

### Docs / Nix
- Managed configuration design doc added
- Revset operators and built-in aliases clarified
- Advice for updating repository reworded
- Gerrit documentation typo fixed
- `templates.new_description` example fixed
- Nix build definition moved to `default.nix`

## Full Commit List

```
a347f9097 mise: update cargo-insta version to 1.63.3
3a9e56d06 tests: run `cargo insta test --force-update-snapshots`
35317d7e7 nix: move build definition to `default.nix`
1af49fae9 MergedTreeBuilder: make write_tree() async
58117ee92 revset: accept neighbor expressions at pattern value position
6f4af7784 templater: extract parsing rule for unary negation operators
12f0cb185 templater: accept literal and negation at pattern value position
100d348ed design: Add design doc for managed configuration
bbe9e9d90 gerrit: Implement `jj gerrit upload` options.
cb70b95dd cli: add test for workspace-dependent immutable commits (#7751)
5e0ff5159 debug object: allow lookup by revision for files and symlinks too
c866cc9af conflicts: after parsing markers, write contents to backend concurrently
a9bbbea15 new: evaluate new_description template for new commits
96d28e84e cli: hint for misconfigured default command with whitespace
38fed24fc gerrit upload: support the alternative `Link` change-id trailer
035653f2b templates: add builtin_draft_commit_description_with_diff
721fcf9f6 mise: fix cargo-insta required version
7f14be88d build(deps): bump devalue from 5.6.2 to 5.6.3 in /web/docs
fea6f2ffd tests: exercise more gerrit upload options
8d794162b tests: exercise failures with gerrit upload options
ff7a70c66 revset: check for redefined builtin aliases in a separate loop
8a3d94683 config: extract helper function that loads revset/template aliases
86898bd37 tests: exercise failure cases with gerrit Link footers
a3f180215 MutableRepo: convert functions to async
a5b27961e op_heads_store: make resolve_op_heads accept an async resolver function
bc6609837 RepoLoader: convert functions to async
e59480cbe ReadonlyRepo: convert functions to async
1648ee1ac docs: fix typo in new gerrit documentation
4bc1b9000 split: warn instead of failing on empty commit with path argument
03637e5e2 operation: make `Operation::view` function async
9e15bc317 repo: RepoLoader: make `load_at`, `reload_at` functions async
01c539033 index: make `IndexStore::get_index_at_op` function async
45559d996 index: make `MutableIndex::add_commit` function async
d44a92efb transaction: convert functions to async
6ab12e596 workspace: convert functions to async
08480033c docs: fix example for `templates.new_description`
be5c6895f tests: demonstrate reordering of parents bug when running `new --after`
ac6de9e5c cli: new --after: preserve order of new children's parents
6b1cda418 gerrit: Create default revisions for `jj gerrit upload`
1d1842978 bookmarks: Add jj tug inspired advance command
efd0ccb8d cargo: bump gix to 0.80.0 with --recursive
420242e50 tests: add regression test for bad Git URL decoding
d456c28f3 cargo: bump the cargo-dependencies group across 1 directory with 6 updates
a7ae0f4ee docs: clarify revset operators and built-in aliases
670ac90b0 docs: reword advice for updating your repository
f89aebceb github: bump the github-dependencies group with 2 updates
d815b4f18 cli: progress: add missing copyright header
e24d11712 cli: progress: return io::Error from inner progress writer
080d85f2c cli: progress: make inner progress writer public, rename type
cdda6eaab cli: git-push: inline signing progress callback
fc0ce0e4b cli: show progress of "debug index-changed-paths" command
```
